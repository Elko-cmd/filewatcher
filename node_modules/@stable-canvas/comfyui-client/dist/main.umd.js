!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).comfyuiClient={})}(this,function(e){function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(null,arguments)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}var u=function(e){var t={exports:{}};return function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var u=new o(r,i||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],u]:e._events[c].push(u):(e._events[c]=u,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},u.prototype.listeners=function(e){var t=this._events[n?n+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,o=t.length,i=new Array(o);r<o;r++)i[r]=t[r].fn;return i},u.prototype.listenerCount=function(e){var t=this._events[n?n+e:e];return t?t.fn?1:t.length:0},u.prototype.emit=function(e,t,r,o,i,s){var u=n?n+e:e;if(!this._events[u])return!1;var c,a,l=this._events[u],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,o),!0;case 5:return l.fn.call(l.context,t,r,o,i),!0;case 6:return l.fn.call(l.context,t,r,o,i,s),!0}for(a=1,c=new Array(h-1);a<h;a++)c[a-1]=arguments[a];l.fn.apply(l.context,c)}else{var f,p=l.length;for(a=0;a<p;a++)switch(l[a].once&&this.removeListener(e,l[a].fn,void 0,!0),h){case 1:l[a].fn.call(l[a].context);break;case 2:l[a].fn.call(l[a].context,t);break;case 3:l[a].fn.call(l[a].context,t,r);break;case 4:l[a].fn.call(l[a].context,t,r,o);break;default:if(!c)for(f=1,c=new Array(h-1);f<h;f++)c[f-1]=arguments[f];l[a].fn.apply(l[a].context,c)}}return!0},u.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var u=this._events[i];if(u.fn)u.fn!==t||o&&!u.once||r&&u.context!==r||s(this,i);else{for(var c=0,a=[],l=u.length;c<l;c++)(u[c].fn!==t||o&&!u[c].once||r&&u[c].context!==r)&&a.push(u[c]);a.length?this._events[i]=1===a.length?a[0]:a:s(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?this._events[t=n?n+e:e]&&s(this,t):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,e.exports=u}(t),t.exports}(),c=function(e){return null==e},a=/*#__PURE__*/function(){function e(t){var n,r,o,i,s,c,a;if(this.api_host=void 0,this.api_base=void 0,this.clientId=void 0,this.socket=void 0,this.WebSocket=void 0,this.ssl=void 0,this.user=void 0,this.fetch=void 0,this.events=new u,this.socket_callbacks={},this._polling_timer=null,this._polling_interval=1e3,this.closed=!1,this.api_host=null!=(n=t.api_host)?n:e.DEFAULT_API_HOST,this.api_base=null!=(r=t.api_base)?r:e.DEFAULT_API_BASE,this.clientId=null!=(o=t.clientId)?o:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),this.WebSocket=null!=(i=t.WebSocket)?i:globalThis.WebSocket,this.ssl=null!=(s=t.ssl)&&s,this.user=null!=(c=t.user)?c:e.DEFAULT_USER,!globalThis.fetch)throw new Error("fetch is not defined");this.fetch=null!=(a=t.fetch)?a:globalThis.fetch.bind(globalThis),this.WebSocket||console.warn("No WebSocket implementation available, WebSocket disabled")}e.loadImageData=function(e){var t=new DataView(e).getUint32(0);if(1===t)return new DataView(e).getUint32(0),e.slice(8);throw new Error("Unknown binary websocket message of type "+t)};var t,n,o=e.prototype;return o.apiHeaders=function(e){var t;return r({},this.user?{"Comfy-User":this.user}:{},{Accept:"*/*"},null!=(t=null==e?void 0:e.headers)?t:{})},o.apiURL=function(e){var t=new URL("http"+(this.ssl?"s":"")+"://"+this.api_host),n=(this.api_base+e).split("?"),r=n[1];return t.pathname=n[0],t.pathname=t.pathname.replace(/\/+/g,"/"),r&&(t.search=r),this.clientId&&t.searchParams.set("clientId",this.clientId),t.toString()},o.viewURL=function(e,t,n){var r=new URLSearchParams({filename:e,subfolder:t,type:n}).toString();return"http"+(this.ssl?"s":"")+"://"+this.api_host+this.api_base+"/view?"+r},o.wsURL=function(){var e=new URL("ws"+(this.ssl?"s":"")+"://"+this.api_host);return e.pathname="/ws",this.clientId&&e.searchParams.set("clientId",this.clientId),e.toString()},o.fetchApi=function(e,t){try{var n=this;if(n.closed)throw new Error("Client is closed");var o=n.apiURL(e);return Promise.resolve(n.fetch(o,r({},t,{headers:n.apiHeaders(t)})))}catch(e){return Promise.reject(e)}},o.addEventListener=function(e,t,n){var r=this;return this.events.on(e,t,n),function(){r.events.off(e,t)}},o.on=function(e,t,n){return this.addEventListener(e,t,n)},o.startPollingQueue=function(){var e=this;this._polling_timer||(this._polling_timer=setInterval(function(){try{var t=function(t,n){try{var r=Promise.resolve(e.fetchApi("/prompt")).then(function(t){return Promise.resolve(t.json()).then(function(t){e.events.emit("status",t)})})}catch(e){return n()}return r&&r.then?r.then(void 0,n):r}(0,function(){e.events.emit("status",null)});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},this._polling_interval))},o.addSocketCallback=function(e,t,n,r){var o=this;return this.socket_callbacks[t]=n,e.addEventListener(t,n,r),function(){delete o.socket_callbacks[t],e.removeEventListener(t,n,r)}},o.removeSocketCallbacks=function(){if(this.socket)for(var e in this.socket_callbacks)this.socket.removeEventListener(e,this.socket_callbacks[e]);this.socket_callbacks={}},o.createSocket=function(t){var n=this;if(void 0===t&&(t=!1),!this.socket){if(!this.WebSocket)throw new Error("WebSocket is not defined, please provide a WebSocket implementation");if(!this.closed){var r=!1;this.socket=new this.WebSocket(this.wsURL()),this.socket.binaryType="arraybuffer",this.addSocketCallback(this.socket,"open",function(){r=!0,t&&n.events.emit("reconnected")}),this.addSocketCallback(this.socket,"error",function(){n.socket&&n.socket.close(),t||r||n.startPollingQueue()}),this.addSocketCallback(this.socket,"close",function(){setTimeout(function(){n.socket=null,n.createSocket(!0)},300),r&&(n.events.emit("status",null),n.events.emit("reconnecting"))}),this.addSocketCallback(this.socket,"message",function(t){if(n.events.emit("message",t),function(t){return"string"!=typeof t.data&&(e.IS_BROWSER?t.data instanceof Blob:!!(ArrayBuffer&&t.data instanceof ArrayBuffer)||!(!Buffer||!Buffer.isBuffer(t.data)))}(t)){var r=e.loadImageData(t.data);n.events.emit("image_data",r)}else{var o=JSON.parse(t.data);switch(o.type){case"status":o.data.sid&&(n.clientId=o.data.sid),n.events.emit("status",o.data.status);break;case"progress":n.events.emit("progress",o.data);break;case"executing":n.events.emit("executing",o.data);break;case"executed":n.events.emit("executed",o.data);break;case"execution_start":n.events.emit("execution_start",o.data);break;case"execution_error":n.events.emit("execution_error",o.data);break;case"execution_cached":n.events.emit("execution_cached",o.data);break;case"execution_interrupted":n.events.emit("execution_interrupted",o.data);break;default:n.events.emit(o.type,o.data)}!1===n.registered.includes(o.type)&&n.events.emit("unhandled",o)}})}}},o.init=function(){this.createSocket()},o.close=function(){this.closed||(this.closed=!0,this.events.emit("close"),this.disconnect(),this.events.removeAllListeners())},o.connect=function(e){var t,n=void 0===e?{}:e,r=n.polling,o=void 0===r?{enabled:!1}:r,i=n.websocket,s=void 0===i?{enabled:!0}:i;return null!=o&&o.enabled&&(this._polling_interval=null!=(t=o.interval)?t:this._polling_interval,this.startPollingQueue()),null!=s&&s.enabled&&this.createSocket(),this},o.disconnect=function(){this.socket?this._disconnectSocket():process.nextTick(this._disconnectPolling.bind(this)),this._disconnectPolling()},o._disconnectSocket=function(){var e=this.socket;if(e){this.socket=null;try{e.readyState===e.OPEN&&e.close(1e3,"Client closed")}catch(e){}this.removeSocketCallbacks(),"removeAllListeners"in e&&(null==e.removeAllListeners||e.removeAllListeners())}},o._disconnectPolling=function(){null!==this._polling_timer&&(clearInterval(this._polling_timer),this._polling_timer=null)},t=e,(n=[{key:"registered",get:function(){return this.events.eventNames()}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t}();a.DEFAULT_API_HOST="127.0.0.1:8188",a.DEFAULT_API_BASE="",a.DEFAULT_USER="",a.IS_BROWSER="undefined"!=typeof window;var l=/*#__PURE__*/function(){function e(){this._cached=void 0,this._cached=globalThis[e.KEY]||new Map,globalThis[e.KEY]=this._cached}var t=e.prototype;return t.clear=function(){this._cached.clear()},t.get=function(e){return this._cached.get(e)},t.set=function(e,t){this._cached.set(e,t)},e}();l.KEY="__COMFY_UI_CLIENT_CACHE__";var h=/*#__PURE__*/function(){function e(t,n){var r,o;this.expire_time_ms=void 0,this.enabled=void 0,this._cached=new l,this.cache_ns="",this.expire_time_ms=null!=(r=null==n?void 0:n.expire_time)?r:e._defaultExpire,this.enabled=null==(o=null==n?void 0:n.enabled)||o,this.cache_ns=t}var t=e.prototype;return t.reset=function(){this._cached.clear()},t._hashArgs=function(e){try{return JSON.stringify(e)}catch(t){return e.toString()}},t.warp=function(e,t){var n=this;return this.enabled?function(){var r=[].slice.call(arguments),o=Date.now(),i=n._hashArgs(r),s=n.cache_ns+":"+e+":"+i,u=n._cached.get(s);if(u&&u.expire>o)return u.result;var c=t.apply(void 0,r);return n._cached.set(s,{result:c,expire:o+n.expire_time_ms}),c}:t},e}();function f(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function p(e,t,n){if(!e.s){if(n instanceof d){if(!n.s)return void(n.o=p.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(p.bind(null,e,t),p.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}h._defaultExpire=6e4;var d=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{p(r,1,i(this.v))}catch(e){p(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?p(r,1,t?t(o):o):n?p(r,1,n(o)):p(r,2,o)}catch(e){p(r,2,e)}},r},e}();function v(e){return e instanceof d&&1&e.s}var m=/*#__PURE__*/function(e){function t(t){var n;return(n=e.call(this,t)||this)._cached_fn=void 0,n._plugins=[],n._cached_fn=new h(""+t.api_host,t.cache),n}o(t,e);var i=t.prototype;return i.use=function(e){e.install(this),this._plugins.push(e)},i.getExtensions=function(){try{var e=this,t=e._cached_fn.warp("extensions",function(){try{return Promise.resolve(e.fetchApi("/extensions",{cache:"no-store"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}});return Promise.resolve(t())}catch(e){return Promise.reject(e)}},i.getEmbeddings=function(){try{var e=this,t=e._cached_fn.warp("embeddings",function(){try{return Promise.resolve(e.fetchApi("/embeddings",{cache:"no-store"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}});return Promise.resolve(t())}catch(e){return Promise.reject(e)}},i.getNodeDefs=function(){try{var e=this,t=e._cached_fn.warp("object_info",function(){try{return Promise.resolve(e.fetchApi("/object_info",{cache:"no-store"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}});return Promise.resolve(t())}catch(e){return Promise.reject(e)}},i.resetCache=function(){this._cached_fn.reset()},i.queuePrompt=function(e,t){var n=t.prompt,r=t.workflow;try{var o={client_id:this.clientId,prompt:n,extra_data:{extra_pnginfo:{workflow:r}}};return-1===e?o.front=!0:0!==e&&(o.number=e),Promise.resolve(this.fetchApi("/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).then(function(e){function t(t){return Promise.resolve(e.json())}var n=function(){if(200!==e.status)return Promise.resolve(e.text()).then(function(e){try{throw{response:JSON.parse(e)}}catch(t){throw{response:e}}})}();return n&&n.then?n.then(t):t()})}catch(e){return Promise.reject(e)}},i.getItems=function(e){try{return Promise.resolve("queue"===e?this.getQueue():this.getHistory())}catch(e){return Promise.reject(e)}},i.getQueue=function(){try{var e=this;return Promise.resolve(f(function(){return Promise.resolve(e.fetchApi("/queue")).then(function(t){return Promise.resolve(t.json()).then(function(t){return{Running:t.queue_running.map(function(t){return{prompt:t,remove:{name:"Cancel",cb:function(){return e.interrupt()}}}}),Pending:t.queue_pending.map(function(e){return{prompt:e}})}})})},function(e){return console.error(e),{Running:[],Pending:[]}}))}catch(e){return Promise.reject(e)}},i.getHistory=function(e){void 0===e&&(e=200);try{var t=this;return Promise.resolve(f(function(){return Promise.resolve(t.fetchApi("/history?max_items="+e)).then(function(e){return Promise.resolve(e.json()).then(function(e){return{History:Object.values(e)}})})},function(e){return console.error(e),{History:[]}}))}catch(e){return Promise.reject(e)}},i.getSystemStats=function(){try{return Promise.resolve(this.fetchApi("/system_stats")).then(function(e){return e.json()})}catch(e){return Promise.reject(e)}},i.postApi=function(e,t){try{return Promise.resolve(this.fetchApi("/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0})).then(function(){})}catch(e){return Promise.reject(e)}},i.deleteItem=function(e,t){try{return Promise.resolve(this.postApi(e,{delete:[t]})).then(function(){})}catch(e){return Promise.reject(e)}},i.clearItems=function(e){try{return Promise.resolve(this.postApi(e,{clear:!0})).then(function(){})}catch(e){return Promise.reject(e)}},i.interrupt=function(){try{return Promise.resolve(this.postApi("interrupt",null)).then(function(){})}catch(e){return Promise.reject(e)}},i.free=function(e){try{return Promise.resolve(this.postApi("free",e)).then(function(){})}catch(e){return Promise.reject(e)}},i.getUserConfig=function(){try{return Promise.resolve(this.fetchApi("/users")).then(function(e){return e.json()})}catch(e){return Promise.reject(e)}},i.createUser=function(e){try{return Promise.resolve(this.fetchApi("/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})}))}catch(e){return Promise.reject(e)}},i.getSettings=function(){try{return Promise.resolve(this.fetchApi("/settings")).then(function(e){return e.json()})}catch(e){return Promise.reject(e)}},i.getSetting=function(e){try{return Promise.resolve(this.fetchApi("/settings/"+encodeURIComponent(e))).then(function(e){return e.json()})}catch(e){return Promise.reject(e)}},i.storeSettings=function(e){try{return Promise.resolve(this.fetchApi("/settings",{method:"POST",body:JSON.stringify(e)}))}catch(e){return Promise.reject(e)}},i.storeSetting=function(e,t){try{return Promise.resolve(this.fetchApi("/settings/"+encodeURIComponent(e),{method:"POST",body:JSON.stringify(t)}))}catch(e){return Promise.reject(e)}},i.getUserData=function(e,t){try{return Promise.resolve(this.fetchApi("/userdata/"+encodeURIComponent(e),t))}catch(e){return Promise.reject(e)}},i.storeUserData=function(e,t,n){try{return Promise.resolve(this.fetchApi("/userdata/"+encodeURIComponent(e),r({method:"POST",body:null!=n&&n.stringify?JSON.stringify(t):t},n))).then(function(t){return function(){if(200!==t.status)return Promise.resolve(t.text()).then(function(n){throw new Error("Error storing user data file '"+e+"': "+t.status+" "+n)})}()})}catch(e){return Promise.reject(e)}},i.getSamplers=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.KSampler;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.sampler_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getSchedulers=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.KSampler;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.scheduler)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getSDModels=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.CheckpointLoaderSimple;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.ckpt_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getCNetModels=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.ControlNetLoader;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.control_net_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getUpscaleModels=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.UpscaleModelLoader;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.model_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getHyperNetworks=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.HypernetworkLoader;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.hypernetwork_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getLoRAs=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.LoraLoader;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.lora_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getVAEs=function(){try{return Promise.resolve(this.getNodeDefs()).then(function(e){var t,n=e.VAELoader;return(null==n||null==(t=n.input)||null==(t=t.required)||null==(t=t.vae_name)?void 0:t[0])||[]})}catch(e){return Promise.reject(e)}},i.getPromptStatus=function(e){try{return Promise.resolve(this.getQueue()).then(function(t){var n=t.Pending,r=t.Running.some(function(t){var n;return(null==t||null==(n=t.prompt)?void 0:n[1])===e}),o=n.some(function(t){var n;return(null==t||null==(n=t.prompt)?void 0:n[1])===e});return{running:r,pending:o,done:!r&&!o}})}catch(e){return Promise.reject(e)}},i.getPromptOutputs=function(e){try{return Promise.resolve(this.getHistory()).then(function(t){var n=t.History.find(function(t){return t.prompt[1]===e});if(!n)throw new Error("Prompt ["+e+"] not found in history");var r=n.status.status_str;if("success"!==r)throw new Error("Prompt ["+e+"] failed with status: "+r);return n.outputs})}catch(e){return Promise.reject(e)}},i.getPromptImageResult=function(e){try{var t=this;return Promise.resolve(t.getPromptOutputs(e)).then(function(n){return{images:Object.values(n).flatMap(function(e){return e.images||[]}).map(function(e){var n=e.filename,r=e.subfolder,o=e.type;return c(n)||c(r)||"output"!==o?null:t.viewURL(n,r,o)}).filter(Boolean).map(function(e){return{type:"url",data:e}}),prompt_id:e}})}catch(e){return Promise.reject(e)}},i.waitForPrompt=function(e,t){void 0===t&&(t=1e3);try{var n=this;return Promise.resolve(n.getPromptStatus(e)).then(function(r){var o=function(e,t,n){for(var r;;){var o=e();if(v(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=n();if(i&&i.then){if(!v(i)){r=1;break}i=i.s}if(t){var s=t();if(s&&s.then&&!v(s)){r=2;break}}}var u=new d,c=p.bind(null,u,2);return(0===r?o.then(l):1===r?i.then(a):s.then(h)).then(void 0,c),u;function a(r){i=r;do{if(t&&(s=t())&&s.then&&!v(s))return void s.then(h).then(void 0,c);if(!(o=e())||v(o)&&!o.v)return void p(u,1,i);if(o.then)return void o.then(l).then(void 0,c);v(i=n())&&(i=i.v)}while(!i||!i.then);i.then(a).then(void 0,c)}function l(e){e?(i=n())&&i.then?i.then(a).then(void 0,c):a(i):p(u,1,i)}function h(){(o=e())?o.then?o.then(l).then(void 0,c):l(o):p(u,1,i)}}(function(){return!r.done},void 0,function(){return Promise.resolve(new Promise(function(e){return setTimeout(e,t)})).then(function(){return Promise.resolve(n.getPromptStatus(e)).then(function(e){r=e})})});if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}},i.waitForPromptWebSocket=function(e){try{var t=this,r={images:[],prompt_id:e};return Promise.resolve(new Promise(function(o,i){var s=t.on("image_data",function(e){r.images.push({type:"buff",data:e})}),u=t.on("executed",function(i){if(i.prompt_id===e){for(var a,l=(i.output||{}).images,h=n(void 0===l?[]:l);!(a=h()).done;){var f=a.value||{},p=f.filename,d=f.subfolder,v=f.type;c(p)||c(d)||"output"!==v||r.images.push({type:"url",data:t.viewURL(p,d,v)})}o(r),u(),s()}})}))}catch(e){return Promise.reject(e)}},i.randomizePrompt=function(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];"KSampler"===r.class_type&&(r.inputs.seed=Math.floor(Math.random()*(Math.pow(2,32)-1)))}},i._enqueue_prompt=function(e,t){try{return null!=t&&t.disable_random_seed||this.randomizePrompt(e),Promise.resolve(this.queuePrompt(0,{prompt:e,workflow:null==t?void 0:t.workflow})).then(function(e){if("error"in e)throw new Error(e.error);return e})}catch(e){return Promise.reject(e)}},i.runPrompt=function(e,t){try{var n=this;return Promise.resolve(n._enqueue_prompt(e,t)).then(function(e){var r=e.prompt_id;return Promise.resolve(n.waitForPrompt(r,null==t?void 0:t.polling_ms)).then(function(){return Promise.resolve(n.getPromptImageResult(r))})})}catch(e){return Promise.reject(e)}},i.enqueue_polling=function(e,t){try{var n=this;return Promise.resolve(n._enqueue_prompt(e,t)).then(function(e){var r=e.prompt_id;return Promise.resolve(n.waitForPrompt(r,null==t?void 0:t.polling_ms)).then(function(){return Promise.resolve(n.getPromptImageResult(r))})})}catch(e){return Promise.reject(e)}},i.enqueue=function(e,t){try{var n=this;return Promise.resolve(n._enqueue_prompt(e,t)).then(function(e){var o,i=e.prompt_id;return null!=t&&t.progress&&(o=n.on("progress",function(e){var n=r({},"progress"in e?r({},e.progress):{},e);n.prompt_id===i&&(null==t||null==t.progress||t.progress(n))})),function(e,t){try{var r=Promise.resolve(n.waitForPromptWebSocket(i))}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(0,function(e,t){if(null==o||o(),e)throw t;return t})})}catch(e){return Promise.reject(e)}},t}(a),_=/*#__PURE__*/function(){function e(e,t){this.workflow=void 0,this.client=void 0,this._task_id=void 0,this._enqueue_req=void 0,this._result={images:[],prompt_id:""},this.executed=!1,this.workflow=e,this.client=t}var t=e.prototype;return t.enqueue=function(){var e=this,t=this.workflow;this._enqueue_req=this.client._enqueue_prompt(t.prompt,{workflow:t.workflow}),this._task_id=this._enqueue_req.then(function(e){return e.prompt_id}),this._enqueue_req.then(function(t){e._result.prompt_id=t.prompt_id})},t.load_result_data=function(e){for(var t,r=(e.output||{}).images,o=n(void 0===r?[]:r);!(t=o()).done;){var i=t.value||{},s=i.filename,u=i.subfolder,a=i.type;c(s)||c(u)||"output"!==a||this._result.images.push({type:"url",data:this.client.viewURL(s,u,a)})}},t.query=function(){try{var e=this;if(!e._task_id)throw new Error("This workflow is not enqueued and the execution status cannot be queried");var t=e.client,n=t.getPromptStatus;return Promise.resolve(e._task_id).then(function(e){return n.call(t,e)})}catch(e){return Promise.reject(e)}},t.interrupt=function(){try{var e=this;if(!e._task_id)throw new Error("This workflow is not enqueued and the execution status cannot be interrupt");return Promise.resolve(e._task_id).then(function(t){return Promise.resolve(e.query()).then(function(n){if(!n.done){if(!n.pending){if(n.running)return e.client.interrupt();throw new Error("wrong task status, id: "+t)}e.client.deleteItem("queue",t)}})})}catch(e){return Promise.reject(e)}},t.wait=function(){try{var e=this;if(!e._task_id)throw new Error("This workflow is not enqueued and the execution status cannot be wait");return Promise.resolve(e._task_id).then(function(t){return new Promise(function(n,r){var o,i;o=[],i=function(){return o.forEach(function(e){return e()})},o=[e.client.on("execution_interrupted",function(e){e.prompt_id===t&&(r(new Error("Execution Interrupted")),i())}),e.client.on("image_data",function(t){e.executed||e._result.images.push({type:"buff",data:t})}),e.client.on("executed",function(r){r.prompt_id===t&&(e.load_result_data(r),e.executed=!0,n(e._result),i())})]})})}catch(e){return Promise.reject(e)}},e}(),y=globalThis.structuredClone?globalThis.structuredClone:function(e){return JSON.parse(JSON.stringify(e))},g=/*#__PURE__*/function(){function e(){this._workflow={prompt:{}},this._last_node_id=0,this.classes=this._createClassesProxy()}var t=e.prototype;return t._createClassesProxy=function(){var e=this;return new Proxy({},{get:function(t,n,r){return n in t?t[n]:function(t){var r={class_type:n.toString(),inputs:t},o=(++e._last_node_id).toString();return e._workflow.prompt[o]=r,Array.from({length:10},function(e,t){return[o,t]})}}})},t.reset=function(){this._workflow.prompt={},this._workflow.workflow=void 0,this._last_node_id=0},t.end=function(){return this.workflow()},t.workflow=function(){return y(this._workflow)},t.invoke=function(e){var t=this.instance(e);return t.enqueue(),t.wait()},t.instance=function(e){var t=this.workflow();return new _({prompt:t.prompt,workflow:t.workflow},e)},t.invoke_polling=function(e){var t=this.workflow();return e.enqueue_polling(t.prompt,{workflow:t.workflow})},e}(),P=/*#__PURE__*/function(){function e(){this.hooks=[]}var t=e.prototype;return t.install=function(e){for(var t,r=function(){var n=t.value,r=e,o=r[n.name].bind(e);r[n.name]=function(){return n.fn.bind(e).apply(void 0,[o].concat([].slice.call(arguments)))}},o=n(this.hooks);!(t=o()).done;)r()},t.addHook=function(e){this.hooks.push(e)},e}(),w=/*#__PURE__*/function(e){function t(t){var n,r;return(r=e.call(this)||this).options=void 0,n=this,r.options=t,r.addHook({type:"function",name:"apiURL",fn:function(e){var t=e.apply(void 0,[].slice.call(arguments,1)),r=new URL(t);return r.searchParams.set("token",n.options.token),r.toString()}}),r.addHook({type:"function",name:"wsURL",fn:function(e){var t=e.apply(void 0,[].slice.call(arguments,1)),r=new URL(t);return r.searchParams.set("token",n.options.token),r.toString()}}),r}return o(t,e),t}(P);e.ClientPlugin=P,e.ComfyUIApiClient=m,e.ComfyUIWorkflow=g,e.ComfyUIWsClient=a,e.LoginAuthPlugin=w});
//# sourceMappingURL=main.umd.js.map
